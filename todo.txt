== Transform

When we have stuff like:

	text 'foo'
	html '<i>'
	text 'bar'
	html '</i>'
	text 'baz'

How to proceed for highlighting "foo bar", viz. when the matched text crosses
an HTML tag? It's clunky.

The simplest method is maybe to store the raw text separately as a contiguous
string where fields are separated with some character, and to have pointers to
the raw text in the bytecode. This makes it convenient to match the text with
or without taking into account the structure. We need at least two separate
buffers: one for the raw text + structure, the other for HTML stuff.

For generating the HTML. We keep track of match offsets in an array and, when
generating the HTML, we highlight portions of texts that need to be. There is
no risk of overlap since the HTML is stored separately from the plain text.
Extracting snippets is still somewhat annoying.

What should we do with <foreign> passages, to support language-specific search?


----------------------------

// delete processing instructions + <?xml...
<TEI xml:lang="eng" xmlns="http://www.tei-c.org/ns/1.0">
  // delete these TEI @ (other @ are significant)
  <teiHeader>
    <fileDesc>
      <titleStmt>...</titleStmt>
      <editor ref="part:anac">
        // delete contents; but only when we have filedesc/editor! there is
        // also an editor field in the bibliography
      </editor>
      <respStmt>
        <resp>Creation of the file</resp>
          <persName ref="part:kuch">
            // Delete contents
          </persName>
	  <persName>
            ...
          </persName>
          ...
        </resp>
      </respStmt>
      <publicationStmt>
        <authority>DHARMA</authority> // not always DHARMA! check
        // Within this, only keep <pubPlace>, delete everything else
        <pubPlace>KEEP THIS</pubPlace>
      </publicationStmt>
      <sourceDesc>
        // Only keep if there is non-blank text. We have bibliographies here biblFull
      </sourceDesc>
    </filedesc>
    <encodingDesc>...</encodingDesc> // Delete completely
    <revisionDesc>...</revisionDesc> // Delete completely
  </teiHeader>
  <text xml:space="preserve"> // delete this @
